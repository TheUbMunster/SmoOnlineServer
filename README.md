# Super Mario Odyssey: Online Server

This is my fork of the [official server](https://github.com/CraftyBoss/SuperMarioOdysseyOnline) for the Super Mario Odyssey: Online mod.


## Windows Setup

1. Download latest build from [Releases](https://github.com/TheUbMunster/SmoOnlineServer/releases)
2. Run `Server.exe`
3. `settings.json` is autogenerated in step 2, modify it however you'd like.

## Building (Mac/Linux Setup)

(untested, these are the original instructions)

Must have the [.NET 6 SDK](https://dotnet.microsoft.com/en-us/download) and Git installed.
Run these commands in your shell:
```shell
git clone https://github.com/Sanae6/SmoOnlineServer
cd SmoOnlineServer
# replace run with build to only build the server
dotnet run --project Server/Server.csproj -c Release
```
If you ran `dotnet build` instead of `dotnet run`, you can find the binary at `Server/bin/net6.0/Release/Server.exe`

## Running under systemd

(untested, these are the original instructions)

If you have systemd, you can use the existing systemd serivce.
```shell
cp smo.serivce /etc/systemd/system/smo.service
# edit ExecStart to your path for the server executable and change WorkingDirectory to the server directory
chmod +x filepath to the server executable
systemctl enable --now smo.service
```

## Run docker image

(untested, these are the original instructions)

If you have [docker](https://docs.docker.com/) on your system, you can use the existing docker image.
That way you don't have to build this server yourself or manually handle executables.

```shell
docker  run  --rm  -it  -p 1027:1027  -v "/$PWD/data/://data/"  ghcr.io/sanae6/smo-online-server
# on Windows, depending on the shell you're using, $PWD might not work. Use an absolute path instead.
```

To always check for and use the latest server version you can add `--pull=always` to the options.

Alternatively there's a `docker-compose.yml` for [docker-compose](https://docs.docker.com/compose/) to simplify the command line options:
```shell
# update server
docker-compose pull

# start server
docker-compose up -d

# open the server cli
docker attach `docker-compose ps -q` --sig-proxy=false

# watch server logs
docker-compose logs --tail=20 --follow

# stop server
docker-compose stop
```

## Commands

Run `help` to get what commands are available in the server console.
Run the `loadsettings` command in the console to update the settings without restarting.
Server address and port will require a server restart, but everything else should update when you run `loadsettings`.

[//]: # (TODO: Document all commands, possibly rename them too.)

## Settings

### Server
Address: the ip address of the server, default: 0.0.0.0 # this shouldn't be changed  
Port: the port of the server, default 1027  
Maxplayers: the max amount of players that can join, default: 8  
Flip: flips the player upside down, defaults: enabled: true, pov: both  
Scenario: sync's scenario's for all players on the server, default: false  
Banlist: banned people are unable to join the server, default: false  

### Discord
Token: the token of the bot you want to load into, default: null  
Prefix: the bot prefix to be used, default: $  
LogChannel: logs the server console to that channel, default: null
PVCPort: the port that proximity voice chat clients connect to, default: 12000
AutoSendPVCPassword: whether or not to automatically send the lobby secret for people to join (this prevents unwanted people from joining the vc), default: true
BeginHearingThreshold: the in-game distance at which you just barely begin to hear another person, default: 3500
FullHearingThreshold: the in-game distance at which someone who's close doesn't get any louder as they get closer, default: 750

## Setup

### Server
Setup for this server as opposed to the official server is very similar, no action needs to be taken unless/until you want to enable the voice proximity feature,
to do so, run `voiceprox on/off` to enable/disable voice proximity. Enter `voiceprox` to see if it's currently enabled.

### Client
This client is designed to be simple and do as much of the setup as it can automatically. However, some settings do need to be setup upon the first time you connect to
a server. First, it asks for the host (this is the IP address of the server, to find this, run `pvcip` on the server), Second, it requires your in-game username (This
is the name of the profile you select when starting the game and the name that shows up on your nametag in-game).

That's all you need to interact with the client. You can change your settings (set keybinds for mute/undeafen, change to PTT or PTM, edit your port and ip/host etc.)

For troubleshooting, see the [release](https://github.com/TheUbMunster/SmoOnlineServer/releases) notes.